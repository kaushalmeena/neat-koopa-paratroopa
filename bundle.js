(()=>{"use strict";var e=500,t=400,r="standard",n="training",i="title",a="main",s="death",c="pause",o="start_game",u="restart_game",l="pause_game",f="resume_game",d="quit_game",p="load_state",h="save_state",g="toggle_mode",v="flap_wing",y="green",x="upper",m="lower",S="upper",b="lower",w=document.getElementById("canvas"),H=w.getContext("2d");function O(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function T(e){var t;return Array.isArray(e)&&(t=e[O(0,e.length-1)]),t}function N(e,t,r,n,i,a){return e>r&&e<r+i&&t>n&&t<n+a}function A(e,t,r){return(e-t)/(r-t)}function I(e){return JSON.parse(JSON.stringify(e))}function P(){for(var e={},t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(r[0]instanceof Object){var i=r[0];e.rows=i.rows,e.cols=i.cols,e.data=i.data}else e.rows=r[0],e.cols=r[1],e.data=new Array(e.rows).fill().map((function(){return new Array(e.cols).fill(0)}));return e}function B(e,t){for(var r=0;r<e.rows;r+=1)for(var n=0;n<e.cols;n+=1){var i=e.data[r][n];e.data[r][n]=t(i,r,n)}return e}function E(e,t){if(t instanceof Object){if(e.cols!==t.rows)throw Error("Columns of A must match rows of B");return B(P(e.rows,t.cols),(function(r,n,i){for(var a=0,s=0;s<e.cols;s+=1)a+=e.data[n][s]*t.data[s][i];return a}))}return B(P(e.rows,e.cols),(function(r,n,i){return e.data[n][i]*t}))}function R(e,t){if(t instanceof Object){if(e.rows!==t.rows||e.cols!==t.cols)throw Error("Columns and Rows of A must match Columns and Rows of B");return B(P(e.rows,t.cols),(function(r,n,i){return e.data[n][i]+t.data[n][i]}))}return B(P(e.rows,e.cols),(function(r,n,i){return e.data[n][i]+t}))}function k(e){return B(e,(function(){return 2*Math.random()-1}))}function M(e){return 1/(1+Math.exp(-e))}function W(){for(var e={},t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(r[0]instanceof Object){var i=r[0];e.inputNodes=i.inputNodes,e.hiddenNodes=i.hiddenNodes,e.outputNodes=i.outputNodes,e.weightsIH=i.weightsIH,e.weightsHO=i.weightsHO,e.biasH=i.biasH,e.biasO=i.biasO}else e.inputNodes=r[0],e.hiddenNodes=r[1],e.outputNodes=r[2],e.weightsIH=P(e.hiddenNodes,e.inputNodes),e.weightsHO=P(e.outputNodes,e.hiddenNodes),e.biasH=P(e.hiddenNodes,1),e.biasO=P(e.outputNodes,1),e.weightsIH=k(e.weightsIH),e.weightsHO=k(e.weightsHO),e.biasH=k(e.biasH),e.biasO=k(e.biasO);return e}function C(e,t){if(e.inputNodes!==t.inputNodes||e.hiddenNodes!==t.hiddenNodes||e.outputNodes!==t.outputNodes)throw Error("Number of nodes in A and B must match");return W({weightsIH:B(e.weightsIH,(function(e,r,n){return T([e,t.weightsIH.data[r][n]])})),weightsHO:B(e.weightsHO,(function(e,r,n){return T([e,t.weightsHO.data[r][n]])})),biasH:B(e.biasH,(function(e,r,n){return T([e,t.biasH.data[r][n]])})),biasO:B(e.biasO,(function(e,r,n){return T([e,t.biasO.data[r][n]])})),inputNodes:e.inputNodes,hiddenNodes:e.hiddenNodes,outputNodes:e.outputNodes})}var D="small",_="medium",j="large";var U,J,V,q,G;function Y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var F=new Image;F.src="cfe46cd5741e28a82b42.png";var L,Q=(Y(U={},D,{image:F,sx:64,sy:144,sWidth:32,sHeight:24}),Y(U,_,{image:F,sx:64,sy:120,sWidth:48,sHeight:24}),Y(U,j,{image:F,sx:64,sy:0,sWidth:64,sHeight:24}),U),K=(Y(J={},S,{image:F,sx:32,sy:0,sWidth:32,sHeight:272}),Y(J,b,{image:F,sx:0,sy:0,sWidth:32,sHeight:272}),J),X=(Y(G={},y,(Y(V={},x,{image:F,sx:96,sy:24,sWidth:32,sHeight:48}),Y(V,m,{image:F,sx:96,sy:72,sWidth:32,sHeight:48}),V)),Y(G,"red",(Y(q={},x,{image:F,sx:64,sy:24,sWidth:32,sHeight:48}),Y(q,m,{image:F,sx:64,sy:72,sWidth:32,sHeight:48}),q)),G);function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,r=e.y,n=e.dy,i=e.color,a=e.wing,s=e.brain,c={};return c.color=i||y,c.wing=a||m,c.x=t||50,c.y=r||50,c.dy=n||0,c.brain=s?I(s):W(5,8,2),c.distance=0,c.fitness=0,c}function z(e){e.dy+=.25,e.y+e.dy>0&&(e.y+=e.dy),e.distance+=1}function Z(e){var t=X[e.color][e.wing];H.drawImage(t.image,t.sx,t.sy,t.sWidth,t.sHeight,e.x,e.y,28,42)}function ee(e){clearTimeout(L),e.dy=-5,e.wing=x,L=setTimeout((function(){e.wing=m}),80)}function te(r,n){for(var i=null,a=Number.POSITIVE_INFINITY,s=0;s<n.length;s+=1)if(n[s].active){var c=n[s].x-r.x;c>0&&c<a&&(a=c,i=n[s])}if(i){var o=[],u=i.x-r.x,l=i.y-r.y;o[0]=A(r.y,0,t),o[1]=1-o[0],o[2]=A(u,0,e),o[3]=i.type===b?o[0]:A(l+272,0,t),o[4]=i.type===b?A(l,0,t):o[1];var f=function(e,t){var r,n=B(P((r=t).length,1),(function(e,t){return r[t]})),i=E(e.weightsIH,n);i=B(i=R(i,e.biasH),M);var a=E(e.weightsHO,i);return function(e){for(var t=[],r=0;r<e.rows;r+=1)for(var n=0;n<e.cols;n+=1)t.push(e.data[r][n]);return t}(a=B(a=R(a,e.biasO),M))}(r.brain,o);f[1]>f[0]&&ee(r)}}function re(e,t){if(e.y>442)return!0;for(var r=0;r<t.length;r+=1)if(t[r].active&&(n=e.x+4,i=e.y+4,28,42,a=t[r].x,s=t[r].y,32,272,!(n+28<a||a+32<n||i+42<s||s+272<i)))return!0;var n,i,a,s;return!1}function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,r=e.y,n=e.type,i={};return i.type=n||T([D,_,j]),i.x=t||0,i.y=r||0,i.active=!1,i}function ie(e){e.x-=1}function ae(e){return Math.random()<.1?e+.5*Math.random():e}function se(e){!function(e){for(var t=0;t<e.length;t+=1){var r;(r=e[t]).distance=Math.pow(r.distance,2)}for(var n=0,i=0;i<e.length;i+=1)n+=e[i].distance;for(var a=0;a<e.length;a+=1)e[a].fitness=e[a].distance/n}(e);var t=function(e){for(var t=[],r=0;r<e.length;r+=1)for(var n=100*e[r].fitness,i=0;i<n;i+=1)t.push(e[r]);return t}(e);return function(e){for(var t,r,n=[],i=0;i<500;i+=1){var a=T(e),s=(r=T(e),$({brain:C((t=a).brain,r.brain),color:T([t.color,r.color])}));c=ae,function(e,t){e.weightsIH=B(e.weightsIH,t),e.weightsHO=B(e.weightsHO,t),e.biasH=B(e.biasH,t),e.biasO=B(e.biasO,t)}(s.brain,c),n.push(s)}var c;return n}(t)}function ce(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,r=e.y,n=e.type,i={};return i.type=n||T([S,b]),i.x=t||0,i.y=r||0,i.active=!1,i}function oe(e){e.x-=2}var ue={current:{score:0,generation:1,bestScore:localStorage.getItem("bestScore")||0,bestDistance:0,mode:r,activeScreen:i,playerBird:$(),liveBirds:function(){for(var e=[],t=0;t<500;t+=1){var r=$({color:"red"});e.push(r)}return e}(),deadBirds:[],clouds:function(){for(var e=[],t=0;t<5;t+=1){var r=ne();e.push(r)}return e}(),pipes:function(){for(var e=[],t=0;t<6;t+=1){var r=ce();e.push(r)}return e}()}};function le(){ue.current.score=0,ue.current.playerBird.x=50,ue.current.playerBird.y=50,ue.current.playerBird.dy=0;for(var e=0;e<ue.current.pipes.length;e+=1)(t=ue.current.pipes[e]).x=0,t.y=0,t.active=!1;var t}function fe(e){return function(e){if(Array.isArray(e))return de(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return de(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?de(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const pe=function(){var n;H.fillStyle="#3cbcfc",H.fillRect(0,0,e,t),function(){for(var t,r,n=0,i=0;i<ue.current.clouds.length;i+=1)ue.current.clouds[i].active&&(n+=1,t=ue.current.clouds[i],r=Q[t.type],H.drawImage(r.image,r.sx,r.sy,r.sWidth,r.sHeight,t.x,t.y,r.sWidth,r.sHeight),ie(ue.current.clouds[i]),ue.current.clouds[i].x<-80&&(ue.current.clouds[i].active=!1));if(n<3){var a=ue.current.clouds.findIndex((function(e){return!e.active}));a>-1&&function(t){t.type=T([D,_,j]),t.x=e+O(10,490),t.y=O(30,370),t.active=!0}(ue.current.clouds[a])}}(),function(){for(var t,r,n=0,i=0,a=0;a<ue.current.pipes.length;a+=1)ue.current.pipes[a].active&&(n+=1,i=Math.max(i,ue.current.pipes[a].x),t=ue.current.pipes[a],r=K[t.type],H.drawImage(r.image,r.sx,r.sy,r.sWidth,r.sHeight,t.x,t.y,32,272),oe(ue.current.pipes[a]),ue.current.pipes[a].x<-80&&(ue.current.pipes[a].active=!1,ue.current.score+=1));if(n<4){var s=ue.current.pipes.findIndex((function(e){return!e.active}));if(s>-1){var c=i+O(200,400);!function(t,r){t.type=T([S,b]),t.x=r||e+O(10,490);var n=t.type===b?228:-100,i=t.type===b?128:0;t.y=O(n,i),t.active=!0}(ue.current.pipes[s],c)}}}(),H.font="14px PressStart2P",H.fillStyle="white",H.fillText("SCORE:".concat(ue.current.score),10,10),H.font="14px PressStart2P",H.fillStyle="#f7dc6f",H.fillText("PAUSE",420,10),ue.current.mode===r?(Z(ue.current.playerBird),z(ue.current.playerBird),re(ue.current.playerBird,ue.current.pipes)&&(ue.current.activeScreen=s,ue.current.score>ue.current.bestScore&&(n=ue.current.score,ue.current.bestScore=n,localStorage.setItem("bestScore",n)))):(H.font="14px PressStart2P",H.fillStyle="white",H.fillText("BEST-DISTANCE:".concat(ue.current.bestDistance),10,26),H.fillText("GENERATION:".concat(ue.current.generation),10,42),H.fillText("ALIVE:".concat(ue.current.liveBirds.length,"/").concat(500),10,58),function(){for(var e=0;e<ue.current.liveBirds.length;e+=1){var t;Z(ue.current.liveBirds[e]),z(ue.current.liveBirds[e]),te(ue.current.liveBirds[e],ue.current.pipes),re(ue.current.liveBirds[e],ue.current.pipes)&&(t=ue.current.deadBirds).push.apply(t,fe(ue.current.liveBirds.splice(e,1))),0===ue.current.liveBirds.length&&(ue.current.generation+=1,ue.current.bestDistance=Math.max.apply(Math,fe(ue.current.deadBirds.map((function(e){return e.distance}))).concat([ue.current.bestDistance])),ue.current.liveBirds=se(ue.current.deadBirds),ue.current.deadBirds=[],le())}}())};function he(e){switch(e){case o:ue.current.activeScreen=a;break;case u:le(),ue.current.activeScreen=a;break;case d:le(),ue.current.activeScreen=i;break;case l:ue.current.activeScreen=c;break;case f:ue.current.activeScreen=a;break;case h:t=JSON.stringify(ue.current),localStorage.setItem("state",t),alert("State successfully saved!");break;case p:!function(){var e=localStorage.getItem("state");e?(ue.current=JSON.parse(e),alert("State successfully loaded!")):alert("State was not found!")}();break;case g:ue.current.mode=ue.current.mode===r?n:r;break;case v:ee(ue.current.playerBird)}var t}function ge(){setTimeout((function(){requestAnimationFrame(ge),function(){switch(ue.current.activeScreen){case i:H.textBaseline="top",H.fillStyle="#3196ca",H.fillRect(0,0,e,t),H.fillStyle="white",H.font="72px PressStart2P",H.fillText("NEAT",110,60),H.font="56px PressStart2P",H.fillText("KOOPA",110,128),H.font="28px PressStart2P",H.fillText("PARATROOPA",110,182),H.fillStyle="#f7dc6f",H.font="16px PressStart2P",H.fillText("".concat(ue.current.mode===r?">":" ","STANDARD MODE"),130,230),H.fillText("".concat(ue.current.mode===n?">":" ","TRAINING MODE"),130,250),H.font="24px PressStart2P",H.fillText("START",190,300);break;case a:pe();break;case c:H.textBaseline="top",H.fillStyle="#3196ca",H.fillRect(0,0,e,t),H.fillStyle="white",H.font="44px PressStart2P",H.fillText("PAUSED",118,100),H.fillStyle="#f7dc6f",H.font="24px PressStart2P",H.fillText("RESUME",178,180),H.fillText("SAVE STATE",130,220),H.fillText("LOAD STATE",130,260),H.fillText("QUIT",202,300);break;case s:H.textBaseline="top",H.fillStyle="#3196ca",H.fillRect(0,0,e,t),H.fillStyle="white",H.font="44px PressStart2P",H.fillText("GAME OVER",52,100),H.font="16px PressStart2P",H.fillText("YOUR SCORE",58,170),H.fillText(ue.current.score,58,190),H.fillText("BEST SCORE",280,170),H.fillText(ue.current.bestScore,280,190),H.fillStyle="#f7dc6f",H.font="24px PressStart2P",H.fillText("RESTART",166,250),H.fillText("QUIT",202,290)}}()}),10)}document.fonts.load("44px PressStart2P").then((function(){w.height=t,w.width=e,document.body.onkeyup=function(e){ue.current.activeScreen===a&&("Space"===e.code?he(v):"Escape"===e.code&&he(l))},w.onclick=function(r){var n=r.offsetX/w.offsetWidth*e,y=r.offsetY/w.offsetHeight*t;switch(ue.current.activeScreen){case i:N(n,y,132,230,224,36)?he(g):N(n,y,190,300,120,24)&&he(o);break;case a:N(n,y,420,10,80,14)?he(l):he(v);break;case s:N(n,y,166,250,168,24)?he(u):N(n,y,202,290,96,24)&&he(d);break;case c:N(n,y,178,180,144,24)?he(f):N(n,y,130,220,240,24)?he(h):N(n,y,130,260,240,24)?he(p):N(n,y,202,296,96,24)&&he(d)}},ge()})).catch((function(){alert("Couldn't load font!")})).finally((function(){document.querySelector("#loaderContainer").remove()}))})();
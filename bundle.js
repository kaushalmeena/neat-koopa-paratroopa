(()=>{"use strict";var e="",t=document.getElementById("canvas"),r=t.getContext("2d");function n(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function i(e){var t;return Array.isArray(e)&&(t=e[n(0,e.length-1)]),t}function a(e,t,r,n,i,a){return e>r&&e<r+i&&t>n&&t<n+a}function c(e,t,r){return(e-t)/(r-t)}function o(e){return JSON.parse(JSON.stringify(e))}const s=e+"edb30e59a0a192144da5.png",u=e+"6ff1bb526c5f53603f5f.png",l=e+"3282f18a9f5fbb412a27.png",f=e+"9c9cf8b15326b0e424b0.png",d=e+"a3561cc01dc44644ee84.png",p=e+"434e99b0ae1ebbed72bb.png",h=e+"7bdfa3713f4ba94f26d3.png",g=e+"ed9f20b785526dc26bb2.png",v=e+"295677352f3d91f36f24.png";var b,y,w,S,x;function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var O=new Image;O.src=s;var T=new Image;T.src=u;var I=new Image;I.src=l;var N=new Image;N.src=p;var A=new Image;A.src=h;var P=new Image;P.src=f;var H=new Image;H.src=d;var B=new Image;B.src=g;var E=new Image;E.src=v;var R=(m(b={},1,O),m(b,2,T),m(b,3,I),b),k=(m(y={},1,N),m(y,2,A),y),M=(m(x={},2,(m(w={},1,P),m(w,2,H),w)),m(x,1,(m(S={},1,B),m(S,2,E),S)),x);function C(){for(var e={},t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(r[0]instanceof Object){var i=r[0];e.rows=i.rows,e.cols=i.cols,e.data=i.data}else e.rows=r[0],e.cols=r[1],e.data=new Array(e.rows).fill().map((function(){return new Array(e.cols).fill(0)}));return e}function D(e,t){for(var r=0;r<e.rows;r+=1)for(var n=0;n<e.cols;n+=1){var i=e.data[r][n];e.data[r][n]=t(i,r,n)}return e}function j(e,t){if(t instanceof Object){if(e.cols!==t.rows)throw Error("Columns of A must match rows of B");return D(C(e.rows,t.cols),(function(r,n,i){for(var a=0,c=0;c<e.cols;c+=1)a+=e.data[n][c]*t.data[c][i];return a}))}return D(C(e.rows,e.cols),(function(r,n,i){return e.data[n][i]*t}))}function U(e,t){if(t instanceof Object){if(e.rows!==t.rows||e.cols!==t.cols)throw Error("Columns and Rows of A must match Columns and Rows of B");return D(C(e.rows,t.cols),(function(r,n,i){return e.data[n][i]+t.data[n][i]}))}return D(C(e.rows,e.cols),(function(r,n,i){return e.data[n][i]+t}))}function J(e){return D(e,(function(){return 2*Math.random()-1}))}function V(e){return 1/(1+Math.exp(-e))}function G(){for(var e={},t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(r[0]instanceof Object){var i=r[0];e.inputNodes=i.inputNodes,e.hiddenNodes=i.hiddenNodes,e.outputNodes=i.outputNodes,e.weightsIH=i.weightsIH,e.weightsHO=i.weightsHO,e.biasH=i.biasH,e.biasO=i.biasO}else e.inputNodes=r[0],e.hiddenNodes=r[1],e.outputNodes=r[2],e.weightsIH=C(e.hiddenNodes,e.inputNodes),e.weightsHO=C(e.outputNodes,e.hiddenNodes),e.biasH=C(e.hiddenNodes,1),e.biasO=C(e.outputNodes,1),e.weightsIH=J(e.weightsIH),e.weightsHO=J(e.weightsHO),e.biasH=J(e.biasH),e.biasO=J(e.biasO);return e}function Y(e,t){if(e.inputNodes!==t.inputNodes||e.hiddenNodes!==t.hiddenNodes||e.outputNodes!==t.outputNodes)throw Error("Number of nodes in A and B must match");return G({weightsIH:D(e.weightsIH,(function(e,r,n){return i([e,t.weightsIH.data[r][n]])})),weightsHO:D(e.weightsHO,(function(e,r,n){return i([e,t.weightsHO.data[r][n]])})),biasH:D(e.biasH,(function(e,r,n){return i([e,t.biasH.data[r][n]])})),biasO:D(e.biasO,(function(e,r,n){return i([e,t.biasO.data[r][n]])})),inputNodes:e.inputNodes,hiddenNodes:e.hiddenNodes,outputNodes:e.outputNodes})}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,r=e.y,n=e.dy,i=e.color,a=e.wing,c=e.brain,s={};return s.color=i||2,s.wing=a||2,s.x=t||50,s.y=r||50,s.dy=n||0,s.brain=c?o(c):G(5,8,2),s.distance=0,s.fitness=0,s}function F(e){e.dy+=.25,e.y+e.dy>0&&(e.y+=e.dy),e.distance+=1}function L(e){r.drawImage(M[e.color][e.wing],e.x,e.y,28,42)}function Q(e){e.dy=-5,e.wing=1,setTimeout((function(){e.wing=2}),80)}function K(e,r){for(var n=null,i=Number.POSITIVE_INFINITY,a=0;a<r.length;a+=1){var o=r[a].x-e.x;o>0&&o<i&&(i=o,n=r[a])}if(null!=n){var s=[],u=n.x-e.x,l=n.y-e.y;s[0]=c(e.y,0,t.height),s[1]=1-s[0],s[2]=c(u,0,t.width),s[3]=2===n.type?s[0]:c(l+272,0,t.height),s[4]=2===n.type?c(l,0,t.height):s[1];var f=function(e,t){var r,n=D(C((r=t).length,1),(function(e,t){return r[t]})),i=j(e.weightsIH,n);i=D(i=U(i,e.biasH),V);var a=j(e.weightsHO,i);return function(e){for(var t=[],r=0;r<e.rows;r+=1)for(var n=0;n<e.cols;n+=1)t.push(e.data[r][n]);return t}(a=D(a=U(a,e.biasO),V))}(e.brain,s);f[1]>f[0]&&Q(e)}}function W(e){return Math.random()<.1?e+.5*Math.random():e}function X(e){!function(e){for(var t=0;t<e.length;t+=1){var r;(r=e[t]).distance=Math.pow(r.distance,2)}for(var n=0,i=0;i<e.length;i+=1)n+=e[i].distance;for(var a=0;a<e.length;a+=1)e[a].fitness=e[a].distance/n}(e);var t=function(e){for(var t=[],r=0;r<e.length;r+=1)for(var n=100*e[r].fitness,i=0;i<n;i+=1)t.push(e[r]);return t}(e);return function(e){for(var t,r,n=[],a=0;a<500;a+=1){var c=i(e),o=(r=i(e),q({brain:Y((t=c).brain,r.brain),color:i([t.color,r.color])}));s=W,function(e,t){e.weightsIH=D(e.weightsIH,t),e.weightsHO=D(e.weightsHO,t),e.biasH=D(e.biasH,t),e.biasO=D(e.biasO,t)}(o.brain,s),n.push(o)}var s;return n}(t)}var $={current:{score:0,generation:1,bestScore:localStorage.getItem("bestScore")||0,bestDistance:0,mode:1,activeScreen:1,playerBird:q(),liveBirds:function(){for(var e=[],t=0;t<500;t+=1){var r=q({color:1});e.push(r)}return e}(),deadBirds:[],clouds:[],pipes:[]}};function _(){$.current.score=0,$.current.playerBird.x=50,$.current.playerBird.y=50,$.current.playerBird.dy=0,$.current.clouds=[],$.current.pipes=[]}function z(e){e.x-=1}function Z(e){if(e.y>t.height+10)return!0;for(var r=0;r<$.current.pipes.length;r+=1)if(n=e.x+4,i=e.y+4,24,38,a=$.current.pipes[r].x,c=$.current.pipes[r].y,32,272,!(n+24<a||a+32<n||i+38<c||c+272<i))return!0;var n,i,a,c;return!1}function ee(e){switch(e){case 1:case 4:$.current.activeScreen=2;break;case 2:_(),$.current.activeScreen=2;break;case 5:_(),$.current.activeScreen=1;break;case 3:$.current.activeScreen=4;break;case 7:t=JSON.stringify($.current),localStorage.setItem("state",t),alert("State successfully saved!");break;case 6:!function(){var e=localStorage.getItem("state");e?($.current=JSON.parse(e),alert("State successfully loaded!")):alert("State was not found!")}();break;case 8:$.current.mode=1===$.current.mode?2:1;break;case 9:Q($.current.playerBird)}var t}function te(e){e.x-=2}function re(e){return function(e){if(Array.isArray(e))return ne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ne(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const ie=function(){var e;r.fillStyle="#3cbcfc",r.fillRect(0,0,t.width,t.height),function(){if($.current.clouds.length<5){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.x,a=e.y,c=e.type,o={};return o.x=r||t.width+n(10,500),o.y=a||n(30,t.height-30),o.type=c||i([1,2,3]),o}();$.current.clouds.push(e)}for(var a=0;a<$.current.clouds.length;a+=1)c=$.current.clouds[a],r.drawImage(R[c.type],c.x,c.y),z($.current.clouds[a]),$.current.clouds[a].x<-50&&$.current.clouds.splice(a,1);var c}(),function(){if($.current.pipes.length<5){var e;$.current.pipes.length>0&&(e=$.current.pipes[$.current.pipes.length-1].x+n(200,400));var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.x,a=e.y,c=e.type,o={};if(o.type=c||i([1,2]),o.x=r||t.width+n(10,500),a)o.y=a;else{var s=2===o.type?t.height-272:-100,u=2===o.type?t.height-172:0;o.y=n(s,u)}return o}({x:e});$.current.pipes.push(a)}for(var c=0;c<$.current.pipes.length;c+=1)o=$.current.pipes[c],r.drawImage(k[o.type],o.x,o.y),te($.current.pipes[c]),$.current.pipes[c].x<-50&&($.current.score+=1,$.current.pipes.splice(c,1));var o}(),r.font="14px PressStart2P",r.fillStyle="white",r.fillText("SCORE:".concat($.current.score),10,10),r.font="14px PressStart2P",r.fillStyle="#f7dc6f",r.fillText("PAUSE",420,10),1===$.current.mode?(L($.current.playerBird),F($.current.playerBird),Z($.current.playerBird)&&($.current.activeScreen=3,$.current.score>$.current.bestScore&&(e=$.current.score,$.current.bestScore=e,localStorage.setItem("bestScore",e)))):(r.font="14px PressStart2P",r.fillStyle="white",r.fillText("BEST-DISTANCE:".concat($.current.bestDistance),10,26),r.fillText("GENERATION:".concat($.current.generation),10,42),r.fillText("ALIVE:".concat($.current.liveBirds.length,"/").concat(500),10,58),function(){for(var e=0;e<$.current.liveBirds.length;e+=1){var t;L($.current.liveBirds[e]),F($.current.liveBirds[e]),K($.current.liveBirds[e],$.current.pipes),Z($.current.liveBirds[e])&&(t=$.current.deadBirds).push.apply(t,re($.current.liveBirds.splice(e,1))),0===$.current.liveBirds.length&&($.current.generation+=1,$.current.bestDistance=Math.max.apply(Math,re($.current.deadBirds.map((function(e){return e.distance}))).concat([$.current.bestDistance])),$.current.liveBirds=X($.current.deadBirds),$.current.deadBirds=[],_())}}())};function ae(){setTimeout((function(){requestAnimationFrame(ae),function(){switch($.current.activeScreen){case 1:r.textBaseline="top",r.fillStyle="#3196ca",r.fillRect(0,0,t.width,t.height),r.fillStyle="white",r.font="72px PressStart2P",r.fillText("NEAT",110,60),r.font="56px PressStart2P",r.fillText("KOOPA",110,128),r.font="28px PressStart2P",r.fillText("PARATROOPA",110,182),r.fillStyle="#f7dc6f",r.font="16px PressStart2P",r.fillText("".concat(1===$.current.mode?">":" ","STANDARD MODE"),130,230),r.fillText("".concat(2===$.current.mode?">":" ","TRAINING MODE"),130,250),r.font="24px PressStart2P",r.fillText("START",190,300);break;case 2:ie();break;case 4:r.textBaseline="top",r.fillStyle="#3196ca",r.fillRect(0,0,t.width,t.height),r.fillStyle="white",r.font="44px PressStart2P",r.fillText("PAUSED",118,100),r.fillStyle="#f7dc6f",r.font="24px PressStart2P",r.fillText("RESUME",178,180),r.fillText("SAVE STATE",130,220),r.fillText("LOAD STATE",130,260),r.fillText("QUIT",202,300);break;case 3:r.textBaseline="top",r.fillStyle="#3196ca",r.fillRect(0,0,t.width,t.height),r.fillStyle="white",r.font="44px PressStart2P",r.fillText("GAME OVER",52,100),r.font="16px PressStart2P",r.fillText("YOUR SCORE",58,170),r.fillText($.current.score,58,190),r.fillText("BEST SCORE",280,170),r.fillText($.current.bestScore,280,190),r.fillStyle="#f7dc6f",r.font="24px PressStart2P",r.fillText("RESTART",166,250),r.fillText("QUIT",202,290)}}()}),10)}document.fonts.load("44px PressStart2P").then((function(){document.body.onkeyup=function(e){2===$.current.activeScreen&&("Space"===e.code?ee(9):"Escape"===e.code&&ee(3))},t.onclick=function(e){var r=e.offsetX/t.offsetWidth*t.width,n=e.offsetY/t.offsetHeight*t.height;switch($.current.activeScreen){case 1:a(r,n,132,230,224,36)?ee(8):a(r,n,190,300,120,24)&&ee(1);break;case 2:a(r,n,420,10,80,14)?ee(3):ee(9);break;case 3:a(r,n,166,250,168,24)?ee(2):a(r,n,202,290,96,24)&&ee(5);break;case 4:a(r,n,178,180,144,24)?ee(4):a(r,n,130,220,240,24)?ee(7):a(r,n,130,260,240,24)?ee(6):a(r,n,202,296,96,24)&&ee(5)}},ae()})).catch((function(){alert("Couldn't load font!")})).finally((function(){document.querySelector("#loaderContainer").remove()}))})();
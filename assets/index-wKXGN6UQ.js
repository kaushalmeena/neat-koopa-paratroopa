(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(i){if(i.ep)return;i.ep=!0;const c=r(i);fetch(i.href,c)}})();const Q=10,E=500,f=400,C=-80,h={STANDARD:"standard",TRAINING:"training"},l={TITLE:"title",MAIN:"main",DEATH:"death",PAUSE:"pause"},u={START_GAME:"start_game",RESTART_GAME:"restart_game",PAUSE_GAME:"pause_game",RESUME_GAME:"resume_game",QUIT_GAME:"quit_game",LOAD_STATE:"load_state",SAVE_STATE:"save_state",TOGGLE_MODE:"toggle_mode",FLAP_WING:"flap_wing"},L=500,W=28,D=42,q=.25,j=-5,z=80,O={RED:"red",GREEN:"green"},I={UP:"up",DOWN:"down"},J=4,K=6,k=32,M=272,b=100,Z=200,tt=400,et=10,rt=E-10,nt=f-M+b,st=f-M,it=-b,ot=0,ct=2,P={UPPER:"upper",LOWER:"lower"},x=document.getElementById("canvas"),s=x.getContext("2d");function m(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function p(t){let e;if(Array.isArray(t)){const r=m(0,t.length-1);e=t[r]}return e}function A(t,e,r,o,i,c){return t>r&&t<r+i&&e>o&&e<o+c}function at(t,e,r,o,i,c,a,g){return!(t+r<i||i+a<t||e+o<c||c+g<e)}function N(t,e,r){return(t-e)/(r-e)}function ut(t){return structuredClone(t)}function _(...t){const[e,r,o=()=>0]=t;return{rows:e,cols:r,data:Array.from({length:e},(i,c)=>Array.from({length:r},(a,g)=>o(a,c,g)))}}function y(t,e){return{rows:t.rows,cols:t.cols,data:t.data.map((r,o)=>r.map((i,c)=>e(i,o,c)))}}function v(t,e){if(e instanceof Object){if(t.cols!==e.rows)throw Error("Columns of matrix A must match rows of matrix B");return _(t.rows,e.cols,(r,o,i)=>{let c=0;for(let a=0;a<t.cols;a+=1)c+=t.data[o][a]*e.data[a][i];return c})}return y(t,r=>r*e)}function G(t,e){if(e instanceof Object){if(t.rows!==e.rows||t.cols!==e.cols)throw Error("Columns and Rows of matrix A must match Columns and Rows of matrix B");return _(t.rows,e.cols,(r,o,i)=>t.data[o][i]+e.data[o][i])}return y(t,r=>r+e)}function lt(t){return t.data.flat()}function ft(t){return _(t.length,1,(e,r)=>t[r])}function U(t){return 1/(1+Math.exp(-t))}function R(){return Math.random()*2-1}function dt(...t){const[e,r,o]=t;return{inputNodes:e,hiddenNodes:r,outputNodes:o,weightsIH:_(r,e,R),weightsHO:_(o,r,R),biasH:_(r,1,R),biasO:_(o,1,R)}}function Et(t,e){["weightsIH","weightsHO","biasH","biasO"].forEach(r=>{t[r]=y(t[r],e)})}function St(t,e){if(t.inputNodes!==e.inputNodes||t.hiddenNodes!==e.hiddenNodes||t.outputNodes!==e.outputNodes)throw new Error("Number of nodes in A and B must match");const r=o=>y(t[o],(i,c,a)=>p([i,e[o].data[c][a]]));return{inputNodes:t.inputNodes,hiddenNodes:t.hiddenNodes,outputNodes:t.outputNodes,weightsIH:r("weightsIH"),weightsHO:r("weightsHO"),biasH:r("biasH"),biasO:r("biasO")}}function At(t,e){const r=ft(e),o=y(G(v(t.weightsIH,r),t.biasH),U),i=y(G(v(t.weightsHO,o),t.biasO),U);return lt(i)}const Pt=3,Tt=5,pt=10,It=E-10,_t=30,ht=f-30,mt=1,T={SMALL:"small",MEDIUM:"medium",LARGE:"large"},gt="/neat-koopa-paratroopa/assets/Spritesheet-neP_046B.png",S=new Image;S.src=gt;const xt={[T.SMALL]:{image:S,sx:64,sy:144,sWidth:32,sHeight:24},[T.MEDIUM]:{image:S,sx:64,sy:120,sWidth:48,sHeight:24},[T.LARGE]:{image:S,sx:64,sy:0,sWidth:64,sHeight:24}},yt={[P.UPPER]:{image:S,sx:32,sy:0,sWidth:32,sHeight:272},[P.LOWER]:{image:S,sx:0,sy:0,sWidth:32,sHeight:272}},Mt={[O.GREEN]:{[I.UP]:{image:S,sx:96,sy:24,sWidth:32,sHeight:48},[I.DOWN]:{image:S,sx:96,sy:72,sWidth:32,sHeight:48}},[O.RED]:{[I.UP]:{image:S,sx:64,sy:24,sWidth:32,sHeight:48},[I.DOWN]:{image:S,sx:64,sy:72,sWidth:32,sHeight:48}}};function B({x:t,y:e,dy:r,color:o,wing:i,brain:c}={}){const a={};return a.color=o||O.GREEN,a.wing=i||I.DOWN,a.x=t||50,a.y=e||50,a.dy=r||0,c?a.brain=ut(c):a.brain=dt(5,8,2),a.distance=0,a.fitness=0,a}function Nt(t,e){Et(t.brain,e)}function F(t){t.dy+=q,t.y+t.dy>0&&(t.y+=t.dy),t.distance+=1}function X(t){const e=Mt[t.color][t.wing];s.drawImage(e.image,e.sx,e.sy,e.sWidth,e.sHeight,t.x,t.y,W,D)}function Rt(t,e){return B({brain:St(t.brain,e.brain),color:p([t.color,e.color])})}let H;function V(t){clearTimeout(H),t.dy=j,t.wing=I.UP,H=setTimeout(()=>{t.wing=I.DOWN},z)}function Ot(t,e){let r=null,o=Number.POSITIVE_INFINITY;for(let i=0;i<e.length;i+=1)if(e[i].active){const c=e[i].x-t.x;c>0&&c<o&&(o=c,r=e[i])}if(r){const i=[],c=r.x-t.x,a=r.y-t.y;i[0]=N(t.y,0,f),i[1]=1-i[0],i[2]=N(c,0,E),i[3]=r.type===P.LOWER?i[0]:N(a+M,0,f),i[4]=r.type===P.LOWER?N(a,0,f):i[1];const g=At(t.brain,i);g[1]>g[0]&&V(t)}}function Y(t,e){if(t.y>f+D)return!0;for(let r=0;r<e.length;r+=1)if(e[r].active&&at(t.x+4,t.y+4,W,D,e[r].x,e[r].y,k,M))return!0;return!1}function Dt({x:t,y:e,type:r}={}){const o={};return o.type=r||p([T.SMALL,T.MEDIUM,T.LARGE]),o.x=t||0,o.y=e||0,o.active=!1,o}function wt(){const t=[];for(let e=0;e<Tt;e+=1){const r=Dt();t.push(r)}return t}function Lt(t){t.type=p([T.SMALL,T.MEDIUM,T.LARGE]),t.x=E+m(pt,It),t.y=m(_t,ht),t.active=!0}function Bt(t){t.x-=mt}function vt(t){const e=xt[t.type];s.drawImage(e.image,e.sx,e.sy,e.sWidth,e.sHeight,t.x,t.y,e.sWidth,e.sHeight)}function Gt(t){for(let r=0;r<t.length;r+=1)t[r].distance**=2;let e=0;for(let r=0;r<t.length;r+=1)e+=t[r].distance;for(let r=0;r<t.length;r+=1)t[r].fitness=t[r].distance/e}function Ut(t){const e=[];for(let r=0;r<t.length;r+=1){const o=t[r].fitness*100;for(let i=0;i<o;i+=1)e.push(t[r])}return e}function Ht(t){if(Math.random()<.1){const e=Math.random()*.5;return t+e}return t}function Ct(t){const e=[];for(let r=0;r<L;r+=1){const o=p(t),i=p(t),c=Rt(o,i);Nt(c,Ht),e.push(c)}return e}function Wt(){const t=[];for(let e=0;e<L;e+=1){const r=B({color:O.RED});t.push(r)}return t}function kt(t){Gt(t);const e=Ut(t);return Ct(e)}function bt({x:t,y:e,type:r}={}){const o={};return o.type=r||p([P.UPPER,P.LOWER]),o.x=t||0,o.y=e||0,o.active=!1,o}function Ft(){const t=[];for(let e=0;e<K;e+=1){const r=bt();t.push(r)}return t}function Xt(t,e){t.type=p([P.UPPER,P.LOWER]),t.x=e||E+m(et,rt),t.type===P.LOWER?t.y=m(nt,st):t.y=m(it,ot),t.active=!0}function Vt(t){t.x=0,t.y=0,t.active=!1}function Yt(t){t.x-=ct}function $t(t){const e=yt[t.type];s.drawImage(e.image,e.sx,e.sy,e.sWidth,e.sHeight,t.x,t.y,k,M)}function Qt(){return localStorage.getItem("bestScore")||0}const n={current:{score:0,generation:1,bestScore:Qt(),bestDistance:0,mode:h.STANDARD,activeScreen:l.TITLE,playerBird:B(),liveBirds:Wt(),deadBirds:[],clouds:wt(),pipes:Ft()}};function qt(t){n.current.bestScore=t,localStorage.setItem("bestScore",t)}function w(){n.current.score=0,n.current.playerBird.x=50,n.current.playerBird.y=50,n.current.playerBird.dy=0;for(let t=0;t<n.current.pipes.length;t+=1)Vt(n.current.pipes[t])}function jt(){const t=JSON.stringify(n.current);localStorage.setItem("state",t),alert("State successfully saved!")}function zt(){const t=localStorage.getItem("state");t?(n.current=JSON.parse(t),alert("State successfully loaded!")):alert("State was not found!")}function Jt(){s.textBaseline="top",s.fillStyle="#3196ca",s.fillRect(0,0,E,f),s.fillStyle="white",s.font="44px PressStart2P",s.fillText("GAME OVER",52,100),s.font="16px PressStart2P",s.fillText("YOUR SCORE",58,170),s.fillText(n.current.score,58,190),s.fillText("BEST SCORE",280,170),s.fillText(n.current.bestScore,280,190),s.fillStyle="#f7dc6f",s.font="24px PressStart2P",s.fillText("RESTART",166,250),s.fillText("QUIT",202,290)}function Kt(){s.fillStyle="#3cbcfc",s.fillRect(0,0,E,f)}function Zt(){let t=0;for(let e=0;e<n.current.clouds.length;e+=1)n.current.clouds[e].active&&(t+=1,vt(n.current.clouds[e]),Bt(n.current.clouds[e]),n.current.clouds[e].x<C&&(n.current.clouds[e].active=!1));if(t<Pt){const e=n.current.clouds.findIndex(r=>!r.active);e>-1&&Lt(n.current.clouds[e])}}function te(){let t=0,e=0;for(let r=0;r<n.current.pipes.length;r+=1)n.current.pipes[r].active&&(t+=1,e=Math.max(e,n.current.pipes[r].x),$t(n.current.pipes[r]),Yt(n.current.pipes[r]),n.current.pipes[r].x<C&&(n.current.pipes[r].active=!1,n.current.score+=1));if(t<J){const r=n.current.pipes.findIndex(o=>!o.active);if(r>-1){const o=e+m(Z,tt);Xt(n.current.pipes[r],o)}}}function ee(){X(n.current.playerBird),F(n.current.playerBird),Y(n.current.playerBird,n.current.pipes)&&(n.current.activeScreen=l.DEATH,n.current.score>n.current.bestScore&&qt(n.current.score))}function re(){for(let t=0;t<n.current.liveBirds.length;t+=1)X(n.current.liveBirds[t]),F(n.current.liveBirds[t]),Ot(n.current.liveBirds[t],n.current.pipes),Y(n.current.liveBirds[t],n.current.pipes)&&n.current.deadBirds.push(...n.current.liveBirds.splice(t,1)),n.current.liveBirds.length===0&&(n.current.generation+=1,n.current.bestDistance=Math.max(...n.current.deadBirds.map(e=>e.distance),n.current.bestDistance),n.current.liveBirds=kt(n.current.deadBirds),n.current.deadBirds=[],w())}function ne(){s.font="14px PressStart2P",s.fillStyle="#f7dc6f",s.fillText("PAUSE",420,10)}function se(){s.font="14px PressStart2P",s.fillStyle="white",s.fillText(`SCORE:${n.current.score}`,10,10)}function ie(){s.font="14px PressStart2P",s.fillStyle="white",s.fillText(`BEST-DISTANCE:${n.current.bestDistance}`,10,26),s.fillText(`GENERATION:${n.current.generation}`,10,42),s.fillText(`ALIVE:${n.current.liveBirds.length}/${L}`,10,58)}function oe(){Kt(),Zt(),te(),se(),ne(),n.current.mode===h.STANDARD?ee():(ie(),re())}function ce(){s.textBaseline="top",s.fillStyle="#3196ca",s.fillRect(0,0,E,f),s.fillStyle="white",s.font="44px PressStart2P",s.fillText("PAUSED",118,100),s.fillStyle="#f7dc6f",s.font="24px PressStart2P",s.fillText("RESUME",178,180),s.fillText("SAVE STATE",130,220),s.fillText("LOAD STATE",130,260),s.fillText("QUIT",202,300)}function ae(){s.textBaseline="top",s.fillStyle="#3196ca",s.fillRect(0,0,E,f),s.fillStyle="white",s.font="72px PressStart2P",s.fillText("NEAT",110,60),s.font="56px PressStart2P",s.fillText("KOOPA",110,128),s.font="28px PressStart2P",s.fillText("PARATROOPA",110,182),s.fillStyle="#f7dc6f",s.font="16px PressStart2P",s.fillText(`${n.current.mode===h.STANDARD?">":" "}STANDARD MODE`,130,230),s.fillText(`${n.current.mode===h.TRAINING?">":" "}TRAINING MODE`,130,250),s.font="24px PressStart2P",s.fillText("START",190,300)}function d(t){switch(t){case u.START_GAME:n.current.activeScreen=l.MAIN;break;case u.RESTART_GAME:w(),n.current.activeScreen=l.MAIN;break;case u.QUIT_GAME:w(),n.current.activeScreen=l.TITLE;break;case u.PAUSE_GAME:n.current.activeScreen=l.PAUSE;break;case u.RESUME_GAME:n.current.activeScreen=l.MAIN;break;case u.SAVE_STATE:jt();break;case u.LOAD_STATE:zt();break;case u.TOGGLE_MODE:n.current.mode=n.current.mode===h.STANDARD?h.TRAINING:h.STANDARD;break;case u.FLAP_WING:V(n.current.playerBird);break}}function ue(){x.height=f,x.width=E,document.body.onkeyup=t=>{switch(n.current.activeScreen){case l.MAIN:t.code==="Space"?d(u.FLAP_WING):t.code==="Escape"&&d(u.PAUSE_GAME);break}},x.onclick=t=>{const e=t.offsetX/x.offsetWidth*E,r=t.offsetY/x.offsetHeight*f;switch(n.current.activeScreen){case l.TITLE:A(e,r,132,230,224,36)?d(u.TOGGLE_MODE):A(e,r,190,300,120,24)&&d(u.START_GAME);break;case l.MAIN:A(e,r,420,10,80,14)?d(u.PAUSE_GAME):d(u.FLAP_WING);break;case l.DEATH:A(e,r,166,250,168,24)?d(u.RESTART_GAME):A(e,r,202,290,96,24)&&d(u.QUIT_GAME);break;case l.PAUSE:A(e,r,178,180,144,24)?d(u.RESUME_GAME):A(e,r,130,220,240,24)?d(u.SAVE_STATE):A(e,r,130,260,240,24)?d(u.LOAD_STATE):A(e,r,202,296,96,24)&&d(u.QUIT_GAME);break}}}function le(){switch(n.current.activeScreen){case l.TITLE:ae();break;case l.MAIN:oe();break;case l.PAUSE:ce();break;case l.DEATH:Jt();break}}function $(){setTimeout(()=>{requestAnimationFrame($),le()},Q)}function fe(){document.fonts.load("44px PressStart2P").then(()=>{ue(),$()}).catch(()=>{alert("Couldn't load font!")}).finally(()=>{document.querySelector(".loader-container").remove()})}fe();
